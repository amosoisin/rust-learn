# èª²é¡Œ07: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†

[[èª²é¡Œ06-ãƒ­ã‚°ãƒ‘ãƒ¼ã‚µãƒ¼|â† å‰ã®èª²é¡Œ]]  |  [[README|ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹]]

**é›£æ˜“åº¦:** â­ï¸â­ï¸â­ï¸â­ï¸
**å­¦ç¿’æ™‚é–“ç›®å®‰:** 7-10æ™‚é–“
**å­¦ç¿’ãƒˆãƒ”ãƒƒã‚¯:** ã‚¹ãƒ¬ãƒƒãƒ‰ã€Arcã€Mutexã€ãƒãƒ£ãƒãƒ«ã€ä¸¦è¡Œæ€§

---

## ğŸ¯ èª²é¡Œã®ç›®çš„

Rustã®ä¸¦è¡Œæ€§æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã€è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦åˆ—å‡¦ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

---

## ğŸ“‹ ä»•æ§˜

è¤‡æ•°ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦åˆ—ã«èª­ã¿è¾¼ã¿ã€å˜èªæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
$ cargo run -- count file1.txt file2.txt file3.txt
file1.txt: 1500 words (processed in 0.05s)
file2.txt: 2300 words (processed in 0.08s)
file3.txt: 1800 words (processed in 0.06s)
Total: 5600 words in 0.08s
```

---

## ğŸ—ï¸ å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### åŸºæœ¬çš„ãªãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†

```rust
use std::sync::{Arc, Mutex};
use std::thread;
use std::fs;

fn count_words_parallel(filenames: Vec<String>) -> usize {
    let total = Arc::new(Mutex::new(0));
    let mut handles = vec![];

    for filename in filenames {
        let total = Arc::clone(&total);

        let handle = thread::spawn(move || {
            let contents = fs::read_to_string(&filename).unwrap();
            let count = contents.split_whitespace().count();

            let mut num = total.lock().unwrap();
            *num += count;

            println!("{}: {} words", filename, count);
        });

        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }

    *total.lock().unwrap()
}
```

### ãƒãƒ£ãƒãƒ«ã‚’ä½¿ã£ãŸå®Ÿè£…

```rust
use std::sync::mpsc;
use std::thread;

fn count_words_with_channel(filenames: Vec<String>) -> usize {
    let (tx, rx) = mpsc::channel();
    let mut handles = vec![];

    for filename in filenames {
        let tx = tx.clone();

        let handle = thread::spawn(move || {
            let contents = fs::read_to_string(&filename).unwrap();
            let count = contents.split_whitespace().count();

            tx.send((filename, count)).unwrap();
        });

        handles.push(handle);
    }

    drop(tx);  // é€ä¿¡å´ã‚’ã‚¯ãƒ­ãƒ¼ã‚º

    let mut total = 0;
    for (filename, count) in rx {
        println!("{}: {} words", filename, count);
        total += count;
    }

    for handle in handles {
        handle.join().unwrap();
    }

    total
}
```

---

## ğŸ’¡ Cè¨€èªï¼ˆpthreadsï¼‰ã¨ã®æ¯”è¼ƒ

[[05-ä¸¦è¡Œæ€§]] ã‚’å‚ç…§

---

## ğŸš€ ç™ºå±•èª²é¡Œ

### ãƒ¬ãƒ™ãƒ«1: ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«

### ãƒ¬ãƒ™ãƒ«2: Rayonã§ç°¡æ½”ã«

```rust
use rayon::prelude::*;

fn count_words_rayon(filenames: &[String]) -> usize {
    filenames.par_iter()
        .map(|filename| {
            let contents = fs::read_to_string(filename).unwrap();
            contents.split_whitespace().count()
        })
        .sum()
}
```

---

## ğŸ”— é–¢é€£è³‡æ–™

- [[05-ä¸¦è¡Œæ€§]]
- [The Rust Book: ä¸¦è¡Œæ€§](https://doc.rust-jp.rs/book-ja/ch16-00-concurrency.html)

---

## ğŸ“ å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Arc<Mutex<T>>ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç†è§£ã—ãŸ
- [ ] ãƒãƒ£ãƒãƒ«ã‚’ä½¿ã£ãŸã‚¹ãƒ¬ãƒƒãƒ‰é–“é€šä¿¡ãŒã§ãã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ç«¶åˆã®é˜²æ­¢ã‚’ç†è§£ã—ãŸ

Phase 3ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
