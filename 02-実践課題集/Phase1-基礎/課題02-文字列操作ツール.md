# èª²é¡Œ02: æ–‡å­—åˆ—æ“ä½œãƒ„ãƒ¼ãƒ«

[[èª²é¡Œ01-è¨ˆç®—æ©Ÿãƒ—ãƒ­ã‚°ãƒ©ãƒ |â† å‰ã®èª²é¡Œ]]  |  [[README|ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹]]  |  [[èª²é¡Œ03-CSVãƒ‘ãƒ¼ã‚µãƒ¼|æ¬¡ã®èª²é¡Œ â†’]]

**é›£æ˜“åº¦:** â­ï¸â­ï¸
**å­¦ç¿’æ™‚é–“ç›®å®‰:** 3-4æ™‚é–“
**å­¦ç¿’ãƒˆãƒ”ãƒƒã‚¯:** String vs &strã€æ‰€æœ‰æ¨©ã€å€Ÿç”¨ã€ãƒ™ã‚¯ã‚¿ã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿

---

## ğŸ¯ èª²é¡Œã®ç›®çš„

Rustã®æ–‡å­—åˆ—å‹ï¼ˆ`String`ã¨`&str`ï¼‰ã®é•ã„ã¨ã€æ‰€æœ‰æ¨©ã‚·ã‚¹ãƒ†ãƒ ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®æ–‡å­—åˆ—æ“ä½œãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

### å­¦ã¶ã“ã¨
- **`String` vs `&str` ã®é•ã„**ï¼ˆæœ€é‡è¦ï¼‰
- æ‰€æœ‰æ¨©ã¨ãƒ ãƒ¼ãƒ–
- å€Ÿç”¨ã¨å‚ç…§ï¼ˆ`&`ï¼‰
- ãƒ™ã‚¯ã‚¿ï¼ˆ`Vec<T>`ï¼‰ã®ä½¿ç”¨
- ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®åŸºæœ¬ï¼ˆ`lines()`, `split_whitespace()`ï¼‰
- é–¢æ•°ã®å¼•æ•°ã«`&str`ã‚’ä½¿ã†ã¹ãç†ç”±

---

## ğŸ“‹ ä»•æ§˜

ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€æ§˜ã€…ãªæ–‡å­—åˆ—æ“ä½œã‚’è¡Œã†CLIãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

```bash
# å˜èªæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
$ cargo run -- count sample.txt
Words: 24
Lines: 5
Characters: 155

# ã™ã¹ã¦å¤§æ–‡å­—ã«å¤‰æ›
$ cargo run -- upper sample.txt
HELLO WORLD
RUST IS A SYSTEMS PROGRAMMING LANGUAGE.
...

# ã™ã¹ã¦å°æ–‡å­—ã«å¤‰æ›
$ cargo run -- lower sample.txt
hello world
rust is a systems programming language.
...

# ç‰¹å®šã®å˜èªã‚’æ¤œç´¢ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ï¼‰
$ cargo run -- search sample.txt "rust"
Found 'rust' on line 2: Rust is a systems programming language.
Found 'rust' on line 4: Learning Rust is fun!
Found 'rust' on line 5: Say hello to Rust programming.
```

---

## ğŸ—ï¸ å®Ÿè£…ã®æµã‚Œ

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

```bash
cargo new text_tool
cd text_tool
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

`sample.txt` ã‚’ä½œæˆ:
```text
Hello World
Rust is a systems programming language.
It is fast and memory-safe.
Learning Rust is fun!
Say hello to Rust programming.
```

---

### ã‚¹ãƒ†ãƒƒãƒ—3: String vs &str ã®ç†è§£ï¼ˆè¶…é‡è¦ï¼ï¼‰

Rustã«ã¯2ç¨®é¡ã®æ–‡å­—åˆ—å‹ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒã€Rustç¿’å¾—ã®éµã§ã™ã€‚

#### &strï¼ˆæ–‡å­—åˆ—ã‚¹ãƒ©ã‚¤ã‚¹ï¼‰- å€Ÿç”¨ã•ã‚ŒãŸæ–‡å­—åˆ—

```rust
// æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã¯ &str
let greeting: &str = "Hello";

// String ã‹ã‚‰ã‚¹ãƒ©ã‚¤ã‚¹ã‚’å–å¾—
let owned = String::from("Hello, World!");
let slice: &str = &owned[0..5];  // "Hello"
```

**ç‰¹å¾´:**
- **ä¸å¤‰**ï¼ˆå¤‰æ›´ã§ããªã„ï¼‰
- **å€Ÿç”¨**ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¸ã®å‚ç…§
- ã‚¹ã‚¿ãƒƒã‚¯ä¸Šã®ãƒã‚¤ãƒ³ã‚¿ã¨ã‚µã‚¤ã‚ºã ã‘ï¼ˆ16ãƒã‚¤ãƒˆå›ºå®šï¼‰
- ã‚³ãƒ”ãƒ¼ãŒå®‰ã„

**Cè¨€èªã¨ã®å¯¾æ¯”:**
```c
// Cè¨€èªã®æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ãƒ¡ãƒ¢ãƒªé ˜åŸŸï¼‰
const char *s = "Hello";  // .rodataã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æŒ‡ã™ãƒã‚¤ãƒ³ã‚¿
```

#### Stringï¼ˆæ‰€æœ‰ã•ã‚ŒãŸæ–‡å­—åˆ—ï¼‰- ãƒ’ãƒ¼ãƒ—ä¸Šã®æ–‡å­—åˆ—

```rust
// String::from ã§ä½œæˆ
let s = String::from("Hello");

// to_string() ãƒ¡ã‚½ãƒƒãƒ‰
let s = "Hello".to_string();

// å¤‰æ›´å¯èƒ½
let mut s = String::from("Hello");
s.push_str(", World!");  // "Hello, World!"
```

**ç‰¹å¾´:**
- **å¯å¤‰**ï¼ˆå¤‰æ›´ã§ãã‚‹ï¼‰
- **æ‰€æœ‰æ¨©**ã‚’æŒã¤
- ãƒ’ãƒ¼ãƒ—ä¸Šã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤
- ä¼¸ç¸®å¯èƒ½ï¼ˆ`push_str`, `push`ãªã©ï¼‰

**Cè¨€èªã¨ã®å¯¾æ¯”:**
```c
// Cè¨€èªã®ãƒ’ãƒ¼ãƒ—ä¸Šã®æ–‡å­—åˆ—ãƒãƒƒãƒ•ã‚¡
char *s = malloc(100);
strcpy(s, "Hello");
strcat(s, ", World!");
free(s);  // æ‰‹å‹•è§£æ”¾ãŒå¿…è¦
```

```rust
// Rust
let mut s = String::from("Hello");
s.push_str(", World!");
// ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹ã¨è‡ªå‹•è§£æ”¾
```

---

### ã‚¹ãƒ†ãƒƒãƒ—4: é–¢æ•°å¼•æ•°ã« &str ã‚’ä½¿ã†ç†ç”±

**æ‚ªã„ä¾‹:**
```rust
fn print_text(s: &String) {  // âŒ æŸ”è»Ÿæ€§ãŒä½ã„
    println!("{}", s);
}

fn main() {
    let string = String::from("hello");
    print_text(&string);  // OK

    let literal = "world";
    // print_text(literal);  // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼&StringãŒå¿…è¦
}
```

**è‰¯ã„ä¾‹:**
```rust
fn print_text(s: &str) {  // âœ… æŸ”è»Ÿ
    println!("{}", s);
}

fn main() {
    let string = String::from("hello");
    print_text(&string);  // &Stringã¯è‡ªå‹•çš„ã«&strã«å¤‰æ›ã•ã‚Œã‚‹ï¼ˆderef coercionï¼‰

    let literal = "world";
    print_text(literal);  // &strãªã®ã§ãã®ã¾ã¾æ¸¡ã›ã‚‹
}
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:** é–¢æ•°ã®å¼•æ•°ã«ã¯ `&str` ã‚’ä½¿ã†ï¼ˆã‚ˆã‚Šæ±ç”¨çš„ï¼‰

---

## â— Learn by Doing

**Context:** ç§ãŒåŸºæœ¬çš„ãªmainé–¢æ•°ã®éª¨çµ„ã¿ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚ã“ã‚Œã‹ã‚‰ã€å®Ÿéš›ã®æ–‡å­—åˆ—æ“ä½œã‚’è¡Œã†é–¢æ•°ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚„æ–‡å­—åˆ—ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ã€Rustã®é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«æ…£ã‚Œã¾ã—ã‚‡ã†ã€‚

**Your Task:** ä»¥ä¸‹ã®é–¢æ•°ã‚’`src/main.rs`ã«å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚`TODO(human)`ã®éƒ¨åˆ†ã‚’åŸ‹ã‚ã¦ãã ã•ã„ã€‚

**Guidance:**
- `text.lines()` ã§è¡Œã”ã¨ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å–å¾—
- `text.split_whitespace()` ã§å˜èªã”ã¨ã«åˆ†å‰²
- `text.chars()` ã§æ–‡å­—ã”ã¨ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å–å¾—
- `.count()` ã§ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®è¦ç´ æ•°ã‚’æ•°ãˆã‚‹
- `to_lowercase()` / `to_uppercase()` ã§å¤§æ–‡å­—å°æ–‡å­—å¤‰æ›
- `contains()` ã§éƒ¨åˆ†æ–‡å­—åˆ—ã‚’æ¤œç´¢
- `enumerate()` ã§è¡Œç•ªå·ä»˜ãã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å–å¾—

```rust
use std::env;
use std::fs;
use std::process;

fn main() {
    let args: Vec<String> = env::args().collect();

    if args.len() < 3 {
        eprintln!("Usage: text_tool <command> <filename> [query]");
        eprintln!("Commands: count, upper, lower, search");
        process::exit(1);
    }

    let command = &args[1];
    let filename = &args[2];

    let contents = match read_file(filename) {
        Ok(text) => text,
        Err(e) => {
            eprintln!("Error reading file: {}", e);
            process::exit(1);
        }
    };

    match command.as_str() {
        "count" => {
            let (words, lines, chars) = count_words(&contents);
            println!("Words: {}", words);
            println!("Lines: {}", lines);
            println!("Characters: {}", chars);
        }
        "upper" => {
            println!("{}", to_upper(&contents));
        }
        "lower" => {
            println!("{}", to_lower(&contents));
        }
        "search" => {
            if args.len() < 4 {
                eprintln!("Error: search requires a query");
                process::exit(1);
            }
            let query = &args[3];
            let results = search(&contents, query);

            for (line_num, line) in results {
                println!("Found '{}' on line {}: {}", query, line_num, line);
            }
        }
        _ => {
            eprintln!("Unknown command: {}", command);
            process::exit(1);
        }
    }
}

// ã“ã®é–¢æ•°ã¯å®Ÿè£…æ¸ˆã¿
fn read_file(filename: &str) -> Result<String, std::io::Error> {
    fs::read_to_string(filename)
}

// TODO(human): å˜èªæ•°ã€è¡Œæ•°ã€æ–‡å­—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…
// ãƒ’ãƒ³ãƒˆ:
// - let lines = text.lines().count();
// - let words = text.split_whitespace().count();
// - let chars = text.chars().count();
fn count_words(text: &str) -> (usize, usize, usize) {
    todo!()
}

// TODO(human): ã™ã¹ã¦å¤§æ–‡å­—ã«å¤‰æ›ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…
// ãƒ’ãƒ³ãƒˆ: text.to_uppercase() ã‚’ä½¿ã†
fn to_upper(text: &str) -> String {
    todo!()
}

// TODO(human): ã™ã¹ã¦å°æ–‡å­—ã«å¤‰æ›ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…
// ãƒ’ãƒ³ãƒˆ: text.to_lowercase() ã‚’ä½¿ã†
fn to_lower(text: &str) -> String {
    todo!()
}

// TODO(human): ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ã‚’å«ã‚€è¡Œã‚’æ¤œç´¢ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…
// ãƒ’ãƒ³ãƒˆ:
// 1. let mut results = Vec::new(); ã§çµæœã‚’æ ¼ç´ã™ã‚‹ãƒ™ã‚¯ã‚¿ã‚’ä½œæˆ
// 2. text.lines().enumerate() ã§è¡Œç•ªå·ä»˜ãã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å–å¾—
// 3. line.to_lowercase().contains(&query.to_lowercase()) ã§å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã—ã¦æ¤œç´¢
//    ãŸã ã—ã€åŠ¹ç‡ã®ãŸã‚ query.to_lowercase() ã¯ãƒ«ãƒ¼ãƒ—ã®å¤–ã§ä¸€åº¦ã ã‘å®Ÿè¡Œã™ã¹ã
// 4. è¦‹ã¤ã‹ã£ãŸã‚‰ results.push((i + 1, line.to_string()));
// 5. results ã‚’è¿”ã™
fn search(text: &str, query: &str) -> Vec<(usize, String)> {
    todo!()
}
```

---

## ğŸ’¡ ãƒ’ãƒ³ãƒˆ

### ãƒ’ãƒ³ãƒˆ1: count_words ã®å®Ÿè£…

```rust
fn count_words(text: &str) -> (usize, usize, usize) {
    let lines = text.lines().count();
    let words = text.split_whitespace().count();
    let chars = text.chars().count();

    (words, lines, chars)  // ã‚¿ãƒ—ãƒ«ã§è¿”ã™
}
```

**ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ä¾¿åˆ©ã•:**
```c
// Cè¨€èªãªã‚‰é¢å€’ãªãƒ«ãƒ¼ãƒ—ãŒå¿…è¦
int count_lines(const char *text) {
    int count = 0;
    for (int i = 0; text[i] != '\0'; i++) {
        if (text[i] == '\n') count++;
    }
    return count;
}
```

```rust
// Rustãªã‚‰ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼
let lines = text.lines().count();
```

### ãƒ’ãƒ³ãƒˆ2: to_upper ã¨ to_lower

```rust
fn to_upper(text: &str) -> String {
    text.to_uppercase()  // æ–°ã—ã„Stringã‚’è¿”ã™
}

fn to_lower(text: &str) -> String {
    text.to_lowercase()
}
```

**é‡è¦:** `to_uppercase()` ã¯æ–°ã—ã„`String`ã‚’ä½œæˆã—ã¾ã™ï¼ˆå…ƒã®`&str`ã¯ä¸å¤‰ãªã®ã§ï¼‰ã€‚

### ãƒ’ãƒ³ãƒˆ3: search é–¢æ•°ï¼ˆåŠ¹ç‡çš„ãªå®Ÿè£…ï¼‰

```rust
fn search(text: &str, query: &str) -> Vec<(usize, String)> {
    let mut results = Vec::new();
    let query_lower = query.to_lowercase();  // â† ä¸€åº¦ã ã‘å°æ–‡å­—åŒ–ï¼ˆé‡è¦ï¼ï¼‰

    for (i, line) in text.lines().enumerate() {
        if line.to_lowercase().contains(&query_lower) {
            results.push((i + 1, line.to_string()));
        }
    }

    results
}
```

**éåŠ¹ç‡ãªå®Ÿè£…ï¼ˆé¿ã‘ã‚‹ã¹ãï¼‰:**
```rust
// âŒ æ¯å› query.to_lowercase() ã‚’å‘¼ã¶ã¨ç„¡é§„
if line.to_lowercase().contains(&query.to_lowercase()) {
    // query.to_lowercase() ãŒãƒ«ãƒ¼ãƒ—å†…ã§æ¯å›å®Ÿè¡Œã•ã‚Œã‚‹
}
```

### ãƒ’ãƒ³ãƒˆ4: æ‰€æœ‰æ¨©ã¨ãƒ ãƒ¼ãƒ–

```rust
fn main() {
    let s1 = String::from("hello");
    let s2 = s1;  // s1ã®æ‰€æœ‰æ¨©ãŒs2ã«ã€Œãƒ ãƒ¼ãƒ–ã€ã•ã‚Œã‚‹

    // println!("{}", s1);  // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼s1ã¯ã‚‚ã†ç„¡åŠ¹
    println!("{}", s2);  // OK
}
```

**Cè¨€èªã¨ã®é•ã„:**
```c
char *s1 = malloc(100);
strcpy(s1, "hello");
char *s2 = s1;  // ãƒã‚¤ãƒ³ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆæµ…ã„ã‚³ãƒ”ãƒ¼ï¼‰

printf("%s\n", s1);  // OKï¼ˆå±é™ºã ãŒå‹•ãï¼‰
printf("%s\n", s2);  // OK

free(s1);
// s2ã¯ä»Šãƒ€ãƒ³ã‚°ãƒªãƒ³ã‚°ãƒã‚¤ãƒ³ã‚¿ï¼ˆuse-after-freeï¼‰
```

### ãƒ’ãƒ³ãƒˆ5: å€Ÿç”¨

```rust
fn print_length(s: &String) {  // å€Ÿç”¨ï¼ˆæ‰€æœ‰æ¨©ã¯ç§»å‹•ã—ãªã„ï¼‰
    println!("Length: {}", s.len());
}

fn main() {
    let s = String::from("hello");
    print_length(&s);  // å‚ç…§ã‚’æ¸¡ã™
    println!("{}", s);  // sã¯ã¾ã æœ‰åŠ¹
}
```

---

## âœ… ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

å®Ÿè£…å¾Œã€ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã§å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

```bash
# ã‚«ã‚¦ãƒ³ãƒˆ
$ cargo run -- count sample.txt
Words: 24
Lines: 5
Characters: 155

# å¤§æ–‡å­—å¤‰æ›
$ cargo run -- upper sample.txt
HELLO WORLD
RUST IS A SYSTEMS PROGRAMMING LANGUAGE.
IT IS FAST AND MEMORY-SAFE.
LEARNING RUST IS FUN!
SAY HELLO TO RUST PROGRAMMING.

# å°æ–‡å­—å¤‰æ›
$ cargo run -- lower sample.txt
hello world
rust is a systems programming language.
...

# æ¤œç´¢
$ cargo run -- search sample.txt "rust"
Found 'rust' on line 2: Rust is a systems programming language.
Found 'rust' on line 4: Learning Rust is fun!
Found 'rust' on line 5: Say hello to Rust programming.

$ cargo run -- search sample.txt "hello"
Found 'hello' on line 1: Hello World
Found 'hello' on line 5: Say hello to Rust programming.
```

---

## ğŸ“š å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã®è§£èª¬

### ãƒ¡ãƒ¢ãƒªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆè¦–è¦šçš„ç†è§£ï¼‰

```
Stackï¼ˆã‚¹ã‚¿ãƒƒã‚¯ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ s: &str          â”‚ â† "Hello"ã‚’æŒ‡ã™ãƒã‚¤ãƒ³ã‚¿ï¼ˆ8ãƒã‚¤ãƒˆï¼‰+ é•·ã•ï¼ˆ8ãƒã‚¤ãƒˆï¼‰= 16ãƒã‚¤ãƒˆ
â”‚  â”œâ”€ ptr: 0x1000 â”‚
â”‚  â””â”€ len: 5      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Heapï¼ˆãƒ’ãƒ¼ãƒ—ï¼‰: ãªã—ï¼ˆæ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã¯.rodataã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼‰


String ã®å ´åˆ:
Stack:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ s: String        â”‚
â”‚  â”œâ”€ ptr: 0x2000 â”‚ â† ãƒ’ãƒ¼ãƒ—ã‚’æŒ‡ã™
â”‚  â”œâ”€ len: 5      â”‚
â”‚  â””â”€ cap: 10     â”‚ â† å®¹é‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
Heap:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 'H' 'e' 'l' 'l' 'o' ... â”‚ â† å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### String vs &str ã®ä½¿ã„åˆ†ã‘

| çŠ¶æ³ | ä½¿ã†ã¹ãå‹ | ç†ç”± |
|------|------------|------|
| é–¢æ•°ã®å¼•æ•° | `&str` | æŸ”è»Ÿæ€§ãŒé«˜ã„ |
| é–¢æ•°ã®æˆ»ã‚Šå€¤ï¼ˆæ–°è¦ä½œæˆï¼‰ | `String` | æ‰€æœ‰æ¨©ã‚’æ¸¡ã™ |
| é–¢æ•°ã®æˆ»ã‚Šå€¤ï¼ˆå‚ç…§ï¼‰ | `&str` | å€Ÿç”¨ã®ã¾ã¾è¿”ã™ |
| å¤‰æ›´ãŒå¿…è¦ | `String` | å¯å¤‰ |
| å¤‰æ›´ä¸è¦ | `&str` | åŠ¹ç‡çš„ |

---

## ğŸš€ ç™ºå±•èª²é¡Œ

### ãƒ¬ãƒ™ãƒ«1: çµ±è¨ˆæƒ…å ±ã®è¿½åŠ 

```rust
fn statistics(text: &str) {
    let (words, lines, chars) = count_words(text);

    // TODO: å¹³å‡å˜èªé•·ã‚’è¨ˆç®—
    let total_word_len: usize = text.split_whitespace()
        .map(|word| word.len())
        .sum();
    let avg_word_length = total_word_len as f64 / words as f64;

    // TODO: æœ€é•·ã®å˜èªã‚’è¦‹ã¤ã‘ã‚‹
    let longest_word = text.split_whitespace()
        .max_by_key(|word| word.len())
        .unwrap_or("");

    println!("Average word length: {:.2}", avg_word_length);
    println!("Longest word: {}", longest_word);
}
```

### ãƒ¬ãƒ™ãƒ«2: æ–‡å­—åˆ—ç½®æ›

```bash
$ cargo run -- replace sample.txt "Rust" "Python"
```

### ãƒ¬ãƒ™ãƒ«3: æ­£è¦è¡¨ç¾æ¤œç´¢

```toml
# Cargo.toml
[dependencies]
regex = "1"
```

### ãƒ¬ãƒ™ãƒ«4: ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›

```bash
$ cargo run -- upper sample.txt --output output.txt
Converted text written to output.txt
```

---

## ğŸ“ å®Œå…¨ãªè§£ç­”ä¾‹

è‡ªåˆ†ã§å®Ÿè£…ã—ã¦ã‹ã‚‰è¦‹ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ï¼

<details>
<summary>ã‚¯ãƒªãƒƒã‚¯ã—ã¦è§£ç­”ä¾‹ã‚’è¡¨ç¤º</summary>

```rust
use std::env;
use std::fs;
use std::process;

fn main() {
    let args: Vec<String> = env::args().collect();

    if args.len() < 3 {
        eprintln!("Usage: text_tool <command> <filename> [query]");
        eprintln!("Commands: count, upper, lower, search");
        process::exit(1);
    }

    let command = &args[1];
    let filename = &args[2];

    let contents = match read_file(filename) {
        Ok(text) => text,
        Err(e) => {
            eprintln!("Error reading file: {}", e);
            process::exit(1);
        }
    };

    match command.as_str() {
        "count" => {
            let (words, lines, chars) = count_words(&contents);
            println!("Words: {}", words);
            println!("Lines: {}", lines);
            println!("Characters: {}", chars);
        }
        "upper" => {
            println!("{}", to_upper(&contents));
        }
        "lower" => {
            println!("{}", to_lower(&contents));
        }
        "search" => {
            if args.len() < 4 {
                eprintln!("Error: search requires a query");
                process::exit(1);
            }
            let query = &args[3];
            let results = search(&contents, query);

            for (line_num, line) in results {
                println!("Found '{}' on line {}: {}", query, line_num, line);
            }
        }
        _ => {
            eprintln!("Unknown command: {}", command);
            process::exit(1);
        }
    }
}

fn read_file(filename: &str) -> Result<String, std::io::Error> {
    fs::read_to_string(filename)
}

fn count_words(text: &str) -> (usize, usize, usize) {
    let lines = text.lines().count();
    let words = text.split_whitespace().count();
    let chars = text.chars().count();

    (words, lines, chars)
}

fn to_upper(text: &str) -> String {
    text.to_uppercase()
}

fn to_lower(text: &str) -> String {
    text.to_lowercase()
}

fn search(text: &str, query: &str) -> Vec<(usize, String)> {
    let mut results = Vec::new();
    let query_lower = query.to_lowercase();

    for (i, line) in text.lines().enumerate() {
        if line.to_lowercase().contains(&query_lower) {
            results.push((i + 1, line.to_string()));
        }
    }

    results
}
```

</details>

---

## ğŸ› ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ³•

### ã‚¨ãƒ©ãƒ¼1: "cannot find value `todo` in this scope"

```rust
fn count_words(text: &str) -> (usize, usize, usize) {
    todo!()  // â† ã“ã‚Œã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
}
```

**è§£æ±º:** `todo!()` ã‚’å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆã‚‹

### ã‚¨ãƒ©ãƒ¼2: "mismatched types: expected `(usize, usize, usize)`, found `usize`"

```rust
fn count_words(text: &str) -> (usize, usize, usize) {
    text.lines().count()  // â† usizeã‚’1ã¤ã—ã‹è¿”ã—ã¦ã„ãªã„
}
```

**è§£æ±º:** ã‚¿ãƒ—ãƒ«ã§3ã¤ã®å€¤ã‚’è¿”ã™

```rust
fn count_words(text: &str) -> (usize, usize, usize) {
    let lines = text.lines().count();
    let words = text.split_whitespace().count();
    let chars = text.chars().count();
    (words, lines, chars)  // â† ã‚¿ãƒ—ãƒ«
}
```

### ã‚¨ãƒ©ãƒ¼3: "borrow of moved value: `s`"

```rust
let s = String::from("hello");
let s2 = s;  // sã®æ‰€æœ‰æ¨©ãŒs2ã«ç§»å‹•
println!("{}", s);  // ã‚¨ãƒ©ãƒ¼ï¼sã¯ã‚‚ã†ä½¿ãˆãªã„
```

**è§£æ±º:** ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã‹ã€å€Ÿç”¨ã‚’ä½¿ã†

```rust
let s = String::from("hello");
let s2 = s.clone();  // ã‚¯ãƒ­ãƒ¼ãƒ³
println!("{}, {}", s, s2);  // ä¸¡æ–¹OK
```

---

## ğŸ”— é–¢é€£è³‡æ–™

- [[01-ãƒ¡ãƒ¢ãƒªç®¡ç†ã®æ¯”è¼ƒ]] - æ‰€æœ‰æ¨©ã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°
- [[02-ãƒã‚¤ãƒ³ã‚¿ã¨å‚ç…§ãƒ»å€Ÿç”¨]] - å€Ÿç”¨ãƒ«ãƒ¼ãƒ«ã®æ·±æ˜ã‚Š
- [[ãƒ‡ãƒãƒƒã‚°ã‚¬ã‚¤ãƒ‰]] - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®èª­ã¿æ–¹
- [The Rust Book: æ–‡å­—åˆ—](https://doc.rust-jp.rs/book-ja/ch08-02-strings.html)

---

## âœ… å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `String` ã¨ `&str` ã®é•ã„ã‚’ç†è§£ã—ãŸ
- [ ] æ‰€æœ‰æ¨©ã¨ãƒ ãƒ¼ãƒ–ã®æ¦‚å¿µã‚’ç†è§£ã—ãŸ
- [ ] å€Ÿç”¨ã¨å‚ç…§ã®ä½¿ã„æ–¹ã‚’ç†è§£ã—ãŸ
- [ ] ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’ç¿’å¾—ã—ãŸ
- [ ] ã™ã¹ã¦ã®åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰ãŒå‹•ä½œã™ã‚‹
- [ ] `cargo clippy` ã§è­¦å‘ŠãŒå‡ºãªã„
- [ ] ç™ºå±•èª²é¡Œã«1ã¤ä»¥ä¸Šãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ãŸ

å®Œäº†ã—ãŸã‚‰ã€[[00-å­¦ç¿’é€²æ—ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ]]ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã—ã‚‡ã†ï¼

---

[[èª²é¡Œ03-CSVãƒ‘ãƒ¼ã‚µãƒ¼|æ¬¡ã®èª²é¡Œ: CSVãƒ‘ãƒ¼ã‚µãƒ¼ â†’]]
